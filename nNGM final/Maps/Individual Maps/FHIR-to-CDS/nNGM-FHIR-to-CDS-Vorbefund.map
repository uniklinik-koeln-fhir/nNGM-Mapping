/// version = 0.1
/// title = "nNGM_Mapping_VorbefundCTS"

/* TO DO
    - Once the repeatindex has been implemented, this map needs to be adjusted as the Vorbefund section can have multiple instances.
    [EXTERNES TUMORMATERIAL] Section form 
    - Eingang des Tumormaterials am nNGM-Standort item form doesn't exist in Sea Table. Missing implementation to map in this script.

    Checkboxes are not working, everything is contained in the 'last' checkbox section id_2512
*/

map "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_VorbefundCTS" = nNGM_Mapping_VorbefundCTS

uses "http://hl7.org/fhir/StructureDefinition/Bundle" as source
uses "http://hl7.org/fhir/StructureDefinition/CTS_Transport" as target

group TransformVorbefundCTS(source src: Bundle, target tgt: BackboneElement)
{
    // Metadata
    src -> tgt.crfid = '*-VB1';
    src -> tgt.type  = 'save';

    // Checkboxes for Immunhistochemie (IHC)
    src then TransformImmunhistochemieIHCCheckboxes(src, tgt);

    //Checkboxes for Chromogenic in-situ-Hybridisierung(CISH)
    src then TransformChromogenicinsituHybridisierungCISHCheckboxes(src, tgt);

    //Checkboxes for Fluoreszenz-in-situ-Hybridisierung (FISH)
    src then TransformFluoreszenzinsituHybridisierungFISHCheckboxes(src, tgt);

    //Checkboxes for Fusion NGS
    src then TransformFusionNGSCheckboxes(src, tgt);

    //Checkboxes for Fast Track
    src then TransformFastTrackCheckboxes(src, tgt);

    src.entry as entry then
    {
        /* ------------------------------ Specimen ---------------------------- */
        entry.resource as specimen where "resource is Specimen" then
        {
            //Biopsy-ID -> 27, 0, id_1601
            specimen -> tgt.data as data then
            {
                specimen.identifier as identifier then
                {   
                    specimen -> data.blockindex  = 27;
                    specimen -> data.groupindex  = 0;
                    specimen -> data.itemid      = 'id_1601';
                    identifier.value as value-> data.values as values, 
                                    values.unit  = 'count', 
                                    values.value = value;
                };
            };

            //Eingang des Tumormaterials am nNGM-Standort -> 0, 0, id_2471
            specimen -> tgt.data as data then
            {
                specimen.receivedTime as rt then
                {   
                    specimen -> data.blockindex  = 0;
                    specimen -> data.groupindex  = 0;
                    specimen -> data.itemid      = 'id_2471';
                    rt -> data.values as values, 
                                    values.value = rt;
                };
            };   
        };
        /* -------------------------- DiagnosticReport ------------------------ */
        entry.resource as diagnosticReport where "resource is DiagnosticReport" then
        {

            //Befunddatum -> 0, 0, id_1653
            diagnosticReport -> tgt.data as data then
            {
                diagnosticReport.issued as issued then
                {   
                    diagnosticReport -> data.blockindex  = 0;
                    diagnosticReport -> data.groupindex  = 0;
                    diagnosticReport -> data.itemid      = 'id_1653';
                    issued -> data.values as values, 
                                            values.value = issued;
                };
            };                
            //Befundnummer -> 0, 0, id_1654
            diagnosticReport -> tgt.data as data then
            {
                diagnosticReport.identifier as identifier,
                    identifier.system as system where "system = 'http://uk-koeln.de/NamingSystem/nNGM/befundnummer'" then
                {   
                    diagnosticReport -> data.blockindex  = 0;
                    diagnosticReport -> data.groupindex  = 0;
                    diagnosticReport -> data.itemid      = 'id_1654';
                    identifier.value as value-> data.values as values, 
                                            values.value = value;
                };
            };                
        };
        /* ---------------------- ObservationHistologie ----------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'C18000'" then
        {
            /* -------------------------------- HISTOLOGIE ---------------------------------- */
            //Klassifikation -> klassifikation component -> 1, 0,  id_1658
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.code where "code.coding.code = 'C25161'" then
                    {
                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, coding.code as code then 
                        {
                            observation -> data.blockindex  = 1;
                            observation -> data.groupindex  = 0;
                            observation -> data.itemid      = 'id_1658';
                            code -> data.values as values, 
                                               values.value = code;
                        };
                    };
                };
            };
            //Lokalisation -> 1, 0, id_2469
            observation -> tgt.data as data then
            {
                observation.bodySite as bodySite where "$this.bodySite.coding.system = 'http://uk-koeln.de/fhir/ValueSet/icd-o-3-bodysite'", 
                bodySite.coding as coding then
                {   
                    observation -> data.blockindex = 1;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2469';
                    bodySite    -> data.values as values, 
                                      values.value = evaluate(bodySite, 'coding.code + \'\\t\' + coding.display');
                };
            };
            //Grading -> 1, 0, id_2403
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as cc, cc.coding as coding then
                {   
                    observation -> data.blockindex = 1;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2403';
                    coding.code as code -> data.values as values, 
                                      values.value = code;
                };
            };
        };
        /*---------------------------------------------------------------------
                                 Immunhistochemie (IHC)                         
        ----------------------------------------------------------------------- */
        /* ---------------------- Observation BRAF IHC ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'BRAF'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date Of Assesment -> 4, 0, braf_ihc_group
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex = 4;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'braf_ihc_group';
                    period as dateOfAssessment-> data.values as values, 
                                      values.value = dateOfAssessment;
                };
            };
            //Phänotyp: phanotyp component-> 4, 0, braf_ihc_phaenotype
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C16977'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 4;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'braf_ihc_phaenotype';
                            value   -> data.values as values,
                                        values.value   = value;
                            value   -> data.values as values, 
                                        values.unit    = 'predef', 
                                        values.value   = 'Expresssion';
                    };
                };
            };
            //Ergebnis -> 4, 0, braf_ihc_result
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 4;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'braf_ihc_result';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 4;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'braf_ihc_result';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA1838-4'" then
                {
                    observation -> data.blockindex = 4;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'braf_ihc_result';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /* ---------------------- Observation CK7 IHC ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'CK7'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date Of Assesment -> 5, 0, id_2037
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex = 5;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2037';
                    period as dateOfAssessment-> data.values as values, 
                                      values.value = dateOfAssessment;
                };
            };
            //Phänotyp: phanotyp component-> 5, 0, id_2038
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C16977'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 5;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2038';
                            value   -> data.values as values,
                                        values.value   = value;
                            value   -> data.values as values, 
                                        values.unit    = 'predef', 
                                        values.value   = 'Expresssion';
                    };
                };
            };
            //Ergebnis -> 5, 0, id_2045
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 5;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2045';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 5;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2045';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 5;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2045';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /* --------------------- Observation MIB1 IHC ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'MIB1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date Of Assesment -> 7, 0, id_2055
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation->data.blockindex = 7;
                    observation->data.groupindex = 0;
                    observation->data.itemid     = 'id_2055';
                    period as dateOfAssessment-> data.values as values, 
                                    values.value = dateOfAssessment;
                };
            };
            //Phänotyp: phanotyp component-> 7, 0, id_2056
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C16977'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 7;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2056';
                            value   -> data.values as values,
                                        values.value   = value;
                            value   -> data.values as values, 
                                        values.unit    = 'predef', 
                                        values.value   = 'Expresssion';
                    };
                };
            };
            //Ergebnis -> 7, 0, id_2063
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2063';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2063';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2063';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /* ------------------ Observation Napsin A IHC ----------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'Napsin A'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date Of Assesment -> 14, 0, id_2064
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex   = 14;
                    observation -> data.groupindex   = 0;
                    observation -> data.itemid       = 'id_2064';
                    period as dateOfAssessment-> data.values as values, 
                                        values.value = dateOfAssessment;
                };
            };
            //Phänotyp: phanotyp component-> 14, 0, id_2065
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C16977'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 14;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2065';
                            value   -> data.values as values,
                                        values.value   = value;
                            value   -> data.values as values, 
                                        values.unit    = 'predef', 
                                        values.value   = 'Expresssion';
                    };
                };
            };
            //Ergebnis -> 14, 0, id_2072
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 14;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2072';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 14;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2072';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 14;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2072';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /* ---------------------- Observation P40 IHC ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'P40'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date Of Assesment -> 15, 0, id_2073
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex   = 15;
                    observation -> data.groupindex   = 0;
                    observation -> data.itemid       = 'id_2073';
                    period as dateOfAssessment-> data.values as values, 
                                        values.value = dateOfAssessment;
                };
            };
            //Phänotyp: phanotyp component-> 15, 0, id_2074
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C16977'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 15;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2074';
                            value   -> data.values as values,
                                        values.value   = value;
                            value   -> data.values as values, 
                                        values.unit    = 'predef', 
                                        values.value   = 'Expresssion';
                    };
                };
            };
            //Ergebnis -> 15, 0, id_2079
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 15;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2079';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 15;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2079';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 15;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2079';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /* ----------------- Observation Synaptophysin IHC -------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'Synaptophysin'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date Of Assesment -> 18, 0, id_2080
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex = 18;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2080';
                    period as dateOfAssessment-> data.values as values, 
                                      values.value = dateOfAssessment;
                };
            };
            //Phänotyp: phanotyp component-> 18, 0, id_2081
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C16977'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 18;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2081';
                            value   -> data.values as values,
                                        values.value   = value;
                            value   -> data.values as values, 
                                        values.unit    = 'predef', 
                                        values.value   = 'Expresssion';
                    };
                };
            };
            //Ergebnis -> 18, 0, id_2088
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 18;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2088';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 18;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2088';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 18;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2088';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /* --------------------- Observation TTF1 IHC ------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'TTF1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date Of Assesment -> 19, 0, id_2089
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex   = 19;
                    observation -> data.groupindex   = 0;
                    observation -> data.itemid       = 'id_2089';
                    period as dateOfAssessment-> data.values as values, 
                                        values.value = dateOfAssessment;
                };
            };
            //Phänotyp: phanotyp component-> 19, 0, id_2090
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C16977'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 19;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2090';
                            value   -> data.values as values,
                                        values.value   = value;
                            value   -> data.values as values, 
                                        values.unit    = 'predef', 
                                        values.value   = 'Expresssion';
                    };
                };
            };
            //Ergebnis -> 19, 0, id_2097
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 19;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2097';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 19;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2097';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 19;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2097';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /* --------------------- Observation ALK IHC -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'ALK'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date of Assessment -> 3, 0,id_2098
            //Phaenotyp -> 3, 0, id_2099 
            //these two items shown before were mapped in the following group
            observation then TransformationObservationALKDatePhanotypVorbefund(observation, tgt);

            /* ---------------------------- IHC ---------------------------------- */
            
            //Ergebnis -> 3, 0, id_2106
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2106';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                    observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA11884-6'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2106';
                            code -> data.values as values, 
                                    values.value   = 'fraglich';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2106';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2106';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /* --------------------- Observation MET IHC -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'MET'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date of Assessment -> 6, 0,id_2132
            //Phaenotyp -> 6, 0, id_2133
            //these two items shown before were mapped in the following group
            observation then TransformationObservationMETDatePhanotypVorbefund(observation, tgt);

            //Ergebnis -> 6, 0, id_2139
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2139';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                    observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA11884-6'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2139';
                            code -> data.values as values, 
                                    values.value   = 'fraglich';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2139';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2139';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Klassifikation -> Klassifikation component -> 6, 0, id_2140
            observation -> tgt.data as data then
            {
                observation.component as component,
                component.code where "code.coding.code = 'C25161'" then
                {
                    component.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code then 
                    {
                        observation -> data.blockindex = 6;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2140';
                            code -> data.values as values, values.value = code;
                    };
                };
            };
            //Expression high-level -> expression-high-level component -> 6, 0, id_2141
            observation -> tgt.data as data then
            {
                observation.component as component,
                component.code where "code.coding.code = 'C129474'" then
                {
                    component.valueBoolean as valueBoolean where "value = true" then 
                    {
                        observation  -> data.blockindex = 6;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2141';
                        valueBoolean -> data.values as values, values.value = 'yes';
                    };
                    component.valueBoolean as valueBoolean where "value = false" then 
                    {
                        observation  -> data.blockindex = 6;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2141';
                        valueBoolean -> data.values as values, values.value = 'no';
                    };
                };
            };
        };
        /* --------------------- Observation PD-L1 IHC ------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'PD-L1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date Of Assesment -> 16, 0, id_2172
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex = 16;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2172';
                    period as dateOfAssessment-> data.values as values, 
                                      values.value = dateOfAssessment;
                };
            };
            //Phänotyp: phanotyp component-> 16, 0, id_2173
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C16977'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 16;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2173';
                            value   -> data.values as values,
                                        values.value   = value;
                            value   -> data.values as values, 
                                        values.unit    = 'predef', 
                                        values.value   = 'Expresssion';
                    };
                };
            };
            //Ergebnis -> 16, 0, id_2180
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 16;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2180';
                            code -> data.values as values, 
                                    values.value   = 'auswertbar';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 16;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2180';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Menge der Tumorzellen (% positive Tumorzellen TPS) -> menge-tumorzellen component -> 16, 0, id_2181
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C127771'" then
                    {
                        observation->data.blockindex = 16;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2181';
                        quantity.value as value ->data.values as values, 
                                        values.unit  = 'percent', 
                                        values.value = value;
                    };
                };
            };
            //Fläche positiver Immunzellen / Gesamttumorflächev -> ratio-pos-flaeche component -> 16, 0, id_2182
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'tcell-surface-ratio'" then
                    {
                        observation->data.blockindex = 16;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2182';
                        quantity.value as value ->data.values as values, 
                                        values.unit  = 'percent', 
                                        values.value = value;
                    };
                };
            };
        };
        /* --------------------- Observation ROS1 IHC -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'ROS1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
        {
            //Date of Assessment -> 17, 0,id_2211
            //Phaenotyp -> 17, 0, id_2212
            //these two items shown before were mapped in the following group
            observation then TransformationObservationROS1DatePhanotypVorbefund(observation, tgt);
            
            //Ergebnis -> 17, 0, id_2219
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2219';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                    observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA11884-6'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2219';
                            code -> data.values as values, 
                                    values.value   = 'fraglich';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2219';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2219';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
        };
        /*---------------------------------------------------------------------
                        Chromogenic in-situ-Hybridisierung (CISH)               
        ------------------------------------------------------------------------ */
        /* --------------------- Observation ALK CISH -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'ALK'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ish'" then
        {
            //Date of Assessment -> 3, 0,id_2098
            //Phaenotyp -> 3, 0, id_2099
            //these two items shown before were mapped in the following group
            observation then TransformationObservationALKDatePhanotypVorbefund(observation, tgt);

            //Ergebnis -> 3, 0, id_2112
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2112';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2112';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2112';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Positive Tumorzellen -> pos-tumor-zellen component -> 3, 0, id_2113
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C70460'" then
                    {
                        observation->data.blockindex = 3;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2113';
                        quantity.value as value ->data.values as values, values.unit = 'percent', values.value = value;
                    };
                };
            };
        };
        /* --------------------- Observation MET CISH -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'MET'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ish'" then
        {
            //Date of Assessment -> 6, 0,id_2132
            //Phaenotyp -> 6, 0, id_2133
            //these two items shown before were mapped in the following group
            observation then TransformationObservationMETDatePhanotypVorbefund(observation, tgt);
            
            //Ergebnis -> 6, 0, id_2147
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2147';
                            code -> data.values as values, 
                                    values.value   = 'positiv (high-level amplification)';
                };

                    observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA11884-6'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2147';
                            code -> data.values as values, 
                                    values.value   = 'positiv (moderate-level amplification)';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2147';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2147';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Amplifikation -> amplification-level component -> 6, 0, id_2148
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.code where "code.coding.code = 'amplification-level'" then
                    {
                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, 
                        coding.code as code where "code ='LA6576-8'" then 
                        {
                            observation -> data.blockindex = 6;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2148';
                            code.value as value -> data.values as values,  
                                              values.value = 'Amplifikation high-level';
                        };
                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, 
                        coding.code as code where "code ='LA11884-6'" then 
                        {
                            observation -> data.blockindex = 6;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2148';
                            code.value as value ->data.values as values,  
                                              values.value = 'Amplifikation moderate-level';
                        };
                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, 
                        coding.code as code where "code ='LA32-8'" then 
                        {
                            observation -> data.blockindex = 6;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2148';
                            code.value as value ->data.values as values,  
                                              values.value = 'keine Amplifikation';
                        };
                    };
                };
            };
        };
        /* --------------------- Observation RET CISH -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'RET'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ish'" then
        {
            //Date of Assessment -> 20, 0,id_2183
            //Phaenotyp -> 20, 0, id_2184
            //these two items shown before were mapped in the following group
            observation then TransformationObservationRETDatePhanotypVorbefund(observation, tgt);
            
            //Ergebnis -> 20, 0, id_2191
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2191';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2191';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2191';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Positive Tumorzellen -> pos-tumor-zellen component -> 20, 0, id_2192
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C70460'" then
                    {
                            observation->data.blockindex = 20;
                            observation->data.groupindex = 0;
                            observation->data.itemid     = 'id_2192';
                            quantity.value as value ->data.values as values, 
                                             values.unit = 'percent', 
                                            values.value = value;
                    };
                };
            };
        };
        /* --------------------- Observation ROS1 CISH ------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'ROS1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ish'" then
        {
            //Date of Assessment -> 17, 0,id_2211
            //Phaenotyp -> 17, 0, id_2212
            //these two items shown before were mapped in the following group
            observation then TransformationObservationROS1DatePhanotypVorbefund(observation, tgt);
            
            //Ergebnis -> 17, 0, id_2225
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2225';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2225';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2225';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Positive Tumorzellen -> pos-tumor-zellen component -> 17, 0, id_2226
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C70460'" then
                    {
                        observation->data.blockindex = 17;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2226';
                        quantity.value as value ->data.values as values, 
                                         values.unit = 'percent', 
                                        values.value = value;
                    };
                };
            };
            //Polysomie -> polysomie component -> 17, 0, id_2227
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C36331'" then
                    {
                        observation->data.blockindex = 17;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2227';
                        quantity.value as value ->data.values as values, 
                                         values.unit = 'percent', 
                                        values.value = value;
                    };
                };
            };
        };
        /*----------------------------------------------------------------------
                        Fluoreszenz-in-situ-Hybridisierung (FISH)               
        ------------------------------------------------------------------------ */
        /* --------------------- Observation ALK FISH -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'ALK'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fish'" then
        {
            //Date of Assessment -> 3, 0,id_2098
            //Phaenotyp -> 3, 0, id_2099
            //these two items shown before were mapped in the following group
            observation then TransformationObservationALKDatePhanotypVorbefund(observation, tgt);
            
            //Ergebnis -> 3, 0, id_2119
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2119';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };


                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2119';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2119';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Positive Tumorzellen -> pos-tumor-zellen component -> 3, 0, id_2120
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C70460'" then
                    {
                        observation->data.blockindex = 3;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2120';
                        quantity.value as value ->data.values as values, 
                                         values.unit = 'percent', 
                                        values.value = value;
                    };
                };
            };
            //Polysomie -> polysomie -> 3, 0, id_2121
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C36331'" then
                    {
                        observation->data.blockindex = 3;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2121';
                        quantity.value as value -> data.values as values, 
                                         values.unit = 'percent', 
                                        values.value = value;
                    };
                };
            };
        };
        /* --------------------- Observation MET FISH -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'MET'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fish'" then
        {
            observation then TransformationObservationMETDatePhanotypVorbefund(observation, tgt);
            //Ergebnis -> 6, 0, id_2154
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2154';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2154';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2154';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Amplifikation -> amplification-level component -> 6, 0, id_2155
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.code where "code.coding.code = 'amplification-level'" then
                    {
                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, 
                        coding.code as code where "code ='LA6576-8'" then 
                        {
                            observation -> data.blockindex = 6;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2155';
                            code.value as value ->data.values as values,  
                                              values.value = 'Amplifikation high-level';
                        };

                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, 
                        coding.code as code where "code ='LA11884-6'" then 
                        {
                            observation -> data.blockindex = 6;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2155';
                            code.value as value ->data.values as values,  
                                              values.value = 'Amplifikation intermediate-level';
                        };

                        //TODO:Please verify the value code to change to right  value
                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, 
                        coding.code as code where "code ='LA32-8'" then 
                        {
                            observation -> data.blockindex = 6;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2155';
                            code.value as value -> data.values as values,  
                                              values.value = 'Amplifikation low-level';
                        };

                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, 
                        coding.code as code where "code ='LA6577-6'" then 
                        {
                            observation -> data.blockindex = 6;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2155';
                            code.value as value -> data.values as values,  
                                              values.value = 'negativ';
                        };

                        component.valueCodeableConcept as valueCodeableConcept,
                        valueCodeableConcept.coding as coding, 
                        coding.code as code where "code ='LA18198-4'" then 
                        {
                            observation -> data.blockindex = 6;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2155';
                            code.value as value -> data.values as values,  
                                              values.value = 'nicht auswertbar';
                        };
                    };
                };
            };
            //Prozentzahl an Zellen mit mehr als 15 MET-Signalen pro Zelle (Positiv ≥ 10 %) bei einer high-level Amplifikation
            //15-met-ratio component -> 6, 0, id_2156
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = '15-met-ratio'" then
                    {
                        observation -> data.blockindex = 6;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2156';
                        quantity.value as value -> data.values as values, 
                                        values.unit    = 'percent', 
                                        values.value   =  value;
                    };
                };
            };
            //Prozentzahl an Zellen mit mehr als 5 MET-Signalen pro Zelle (Positiv ≥ 50 %) bei einer intermediate-level Amplifikation
            //5-met-ratio component -> 6, 0, id_2157
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = '5-met-ratio'" then
                    {
                        observation -> data.blockindex = 6;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2157';
                        quantity.value as value -> data.values as values, 
                                        values.unit    = 'percent', 
                                        values.value   =  value;
                    };
                };
            };
            //Prozentzahl an Zellen mit mehr als 4 MET-Signalen pro Zelle (Positiv ≥ 40 %) bei einer low-level Amplifikation
            //4-met-ratio component -> 6, 0, id_2158
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = '4-met-ratio'" then
                    {
                        observation -> data.blockindex = 6;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2158';
                        quantity.value as value -> data.values as values, 
                                        values.unit    = 'percent', 
                                        values.value   =  value;
                    };
                };
            };
            //Gezählte Tumorzellen
            //gezaehlteTumorzellen component > 6, 0, id_2159
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'C0007584'" then
                    {
                        observation  -> data.blockindex = 6;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2159';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //MET Signale
            //met-signale component -> 6, 0, id_2160
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'met-signal-count'" then
                    {
                        observation  -> data.blockindex = 6;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2160';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //CEN Signale
            //CEN-signale  -> 6, 0, id_2161
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'cen-signal-count'" then
                    {
                        observation  -> data.blockindex = 6;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2161';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //Quotient MET/CEN7 Signale
            //quot-met-cen-signal component -> 6, 0, id_2162
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'met-cen-signal-ratio'" then
                    {
                        observation  -> data.blockindex = 6;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2162';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //Durchschnitt MET-Genkopiezahl/Zelle (Positiv ≥ 6)
            //met-copy-pro-zell component -> 6, 0, id_2163
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'met-copy-per-cell'" then
                    {
                        observation  -> data.blockindex = 6;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2163';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //Polysomie
            //polysomie component -> 6, 0, id_2164
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C36331'" then
                    {
                        observation  -> data.blockindex = 6;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2164';
                        quantity.value as value -> data.values as values, 
                                        values.unit     = 'percent', 
                                        values.value    =  value;
                    };
                };
            };
        };
        /* --------------------- Observation RET FISH -------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'RET'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fish'" then
        {
            
            //Date of Assessment -> 20, 0,id_2183
            //Phaenotyp -> 20, 0, id_2184
            //these two items shown before were mapped in the following group
            observation then TransformationObservationRETDatePhanotypVorbefund(observation, tgt);
            
            //Ergebnis -> 20, 0, id_2198
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2198';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2198';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2198';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Positive Tumorzellen -> pos-tumor-zellen component -> 20, 0, id_2199
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C70460'" then
                    {
                            observation -> data.blockindex = 20;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2199';
                            quantity.value as value -> data.values as values, 
                                               values.unit = 'percent', 
                                              values.value = value;
                    };
                };
            };
            //Polysomie
            //polysomie component -> 20, 0, id_2200
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C36331'" then
                    {
                            observation -> data.blockindex = 20;
                            observation -> data.groupindex = 0;
                            observation -> data.itemid     = 'id_2200';
                            quantity.value as value -> data.values as values, 
                                               values.unit = 'percent', 
                                              values.value = value;
                    };
                };
            };
        };
        /* --------------------- Observation ROS1 FISH ------------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'ROS1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fish'" then
        {
            //Date of Assessment -> 17, 0,id_2211
            //Phaenotyp -> 17, 0, id_2212
            //these two items shown before were mapped in the following group
            observation then TransformationObservationROS1DatePhanotypVorbefund(observation, tgt);
            
            //Ergebnis -> 17, 0, id_2233
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2233';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2233';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2233';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Positive Tumorzellen -> pos-tumor-zellen component -> 17, 0, id_2234
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C70460'" then
                    {
                        observation->data.blockindex = 17;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2234';
                        quantity.value as value ->data.values as values, 
                                         values.unit = 'percent', 
                                        values.value = value;
                    };
                };
            };
            //Polysomie -> polysomie component -> 17, 0, id_2235
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C36331'" then
                    {
                        observation->data.blockindex = 17;
                        observation->data.groupindex = 0;
                        observation->data.itemid     = 'id_2235';
                        quantity.value as value ->data.values as values, 
                                         values.unit = 'percent', 
                                        values.value = value;
                    };
                };
            };
        };
        /*----------------------------------------------------------------------
                                    Fusion NGS                                  
        ------------------------------------------------------------------------ */
        /* ------------------ Observation ALK FusionNGS ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'ALK'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date of Assessment -> 3, 0,id_2098
            //Phaenotyp -> 3, 0, id_2099
            //these two items shown before were mapped in the following group
            observation then TransformationObservationALKDatePhanotypVorbefund(observation, tgt);

            //Ergebnis -> 3, 0, id_2127
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2127';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };


                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2127';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 3;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2127';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 3, 0, id_2128
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 3;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2128';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 3, 0, id_2129
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 3;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2129';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //5' Fusionspartner Exon -> fusionspartner-exon component -> 3, 0, id_2130
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 3;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2130';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //ALK Exon -> exon component -> 3, 0, id_2131
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'C13231'" then
                    {
                        observation  -> data.blockindex = 3;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2131';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ------------------ Observation RET FusionNGS ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'RET'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date of Assessment -> 20, 0,id_2183
            //Phaenotyp -> 20, 0, id_2184
            //these two items shown before were mapped in the following group
            observation then TransformationObservationRETDatePhanotypVorbefund(observation, tgt);

            //Ergebnis -> 20, 0, id_2206
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2206';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2206';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 20;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2206';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 20, 0, id_2207
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 20;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2207';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 20, 0, id_2208
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 20;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2208';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //5' Fusionspartner Exon -> fusionspartner-exon component -> 20, 0, id_2209
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 20;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2209';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //RET Exon -> fusionspartner-exon component -> 20, 0, id_2210
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'C13231'" then
                    {
                        observation  -> data.blockindex = 20;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2210';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ----------------- Observation ROS1 FusionNGS ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'ROS1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date of Assessment -> 17, 0,id_2211
            //Phaenotyp -> 17, 0, id_2212
            //these two items shown before were mapped in the following group
            observation then TransformationObservationROS1DatePhanotypVorbefund(observation, tgt);

            //Ergebnis -> 17, 0, id_2241
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2241';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2241';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 17;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2241';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 17, 0, id_2242
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 17;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2242';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 17, 0, id_2243
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 17;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2243';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //5' Fusionspartner Exon -> fusionspartner-exon component -> 17, 0, id_2244
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 17;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2244';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //ROS1 Exon -> fusionspartner-exon component -> 17, 0, id_2245
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'C13231'" then
                    {
                        observation  -> data.blockindex = 17;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2245';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ----------------- Observation NTRK1 FusionNGS ----------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'NTRK1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date Of Assesment -> 8, 0, id_2540
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation->data.blockindex = 8;
                    observation->data.groupindex = 0;
                    observation->data.itemid     = 'id_2540';
                    period as dateOfAssessment-> data.values as values, 
                                    values.value = dateOfAssessment;
                };
            };
            //Ergebnis -> 8, 0, id_2547
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 8;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2547';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 8;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2547';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 8;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2547';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 8, 0, id_2548
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 8;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2548';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 8, 0, id_2549
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 8;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2549';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //5' Fusionspartner Exon -> fusionspartner-exon component -> 8, 0, id_2550
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 8;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2550';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ----------------- Observation NTRK2 FusionNGS ----------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'NTRK2'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date Of Assesment -> 9, 0, id_2592
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex = 9;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2592';
                    period as dateOfAssessment-> data.values as values,
                                      values.value = dateOfAssessment;
                };
            };
            //Ergebnis -> 9, 0, id_2596
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 9;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2596';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 9;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2596';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 9;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2596';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 9, 0, id_2597
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 9;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2597';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 9, 0, id_2598
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 9;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2598';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //5' Fusionspartner Exon -> fusionspartner-exon component -> 9, 0, id_2599
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 9;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2599';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ----------------- Observation NTRK3 FusionNGS ----------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'NTRK3'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date Of Assesment -> 10, 0, id_2584
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation->data.blockindex = 10;
                    observation->data.groupindex = 0;
                    observation->data.itemid     = 'id_2584';
                    period as dateOfAssessment-> data.values as values, values.value = dateOfAssessment;
                };
            };
            //Ergebnis -> 10, 0, id_2588
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 10;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2588';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 10;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2588';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 10;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2588';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 10, 0, id_2589
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 10;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2589';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 10, 0, id_2590
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 10;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2590';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //5' Fusionspartner Exon -> fusionspartner-exon component -> 10, 0, id_2591
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 10;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2591';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ---------------- Observation FGFR1 FusionNGS ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'FGFR1'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date Of Assesment -> 11, 0, id_2576
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation->data.blockindex = 11;
                    observation->data.groupindex = 0;
                    observation->data.itemid     = 'id_2576';
                    period as dateOfAssessment-> data.values as values, 
                                    values.value = dateOfAssessment;
                };
            };
            //Ergebnis -> 11, 0, id_2580
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 11;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2580';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 11;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2580';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 11;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2580';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 11, 0, id_2581
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 11;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2581';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 11, 0, id_2582
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 11;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2582';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //5' Fusionspartner Exon -> fusionspartner-exon component -> 11, 0, id_2583
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 11;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2583';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ---------------- Observation FGFR2 FusionNGS ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'FGFR2'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date Of Assesment -> 12, 0, id_2568
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation->data.blockindex = 12;
                    observation->data.groupindex = 0;
                    observation->data.itemid     = 'id_2568';
                    period as dateOfAssessment-> data.values as values, values.value = dateOfAssessment;
                };
            };
            //Ergebnis -> 12, 0, id_2572
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 12;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2572';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 12;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2572';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 12;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2572';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 12, 0, id_2573
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 12;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2573';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 12, 0, id_2574
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 12;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2574';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //3' Fusionspartner Exon -> fusionspartner-exon component -> 12, 0, id_2575
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 12;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2575';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ---------------- Observation FGFR3 FusionNGS ------------------------ */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'FGFR3'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date Of Assesment -> 13, 0, id_2560
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex = 13;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2560';
                    period as dateOfAssessment-> data.values as values, 
                                      values.value = dateOfAssessment;
                };
            };
            //Ergebnis -> 13, 0, id_2564
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex = 13;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2564';
                            code -> data.values as values, 
                                    values.value   = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex = 13;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2564';
                            code -> data.values as values, 
                                    values.value   = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex = 13;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_2564';
                            code -> data.values as values,
                                    values.value   = 'nicht auswertbar';
                };
            };
            //Fusionspartner -> fusionspartner component -> 13, 0, id_2565
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'C28510'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 13;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_2565';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 13, 0, id_2566
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex = 13;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2566';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
            //3' Fusionspartner Exon -> fusionspartner-exon component -> 13, 0, id_2567
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = 'fusionspartner-exon'" then
                    {
                        observation  -> data.blockindex = 13;
                        observation  -> data.groupindex = 0;
                        observation  -> data.itemid     = 'id_2567';
                        valueInteger -> data.values as values, 
                                        values.unit     = 'count', 
                                        values.value    =  valueInteger;
                    };
                };
            };
        };
        /* ------------- Observation Sonstiges FusionNGS ----------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.code = 'Sonstiges'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
        {
            //Date Of Assesment -> 21, 0, 0, id_2246
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as period then
                {
                    observation -> data.blockindex  = 21;
                    observation -> data.groupindex  = 0;
                    observation -> data.repeatindex = 0;
                    observation -> data.itemid      = 'id_2246';
                    period as dateOfAssessment-> data.values as values, 
                                       values.value = dateOfAssessment;
                };
            };
            //Ergebnis -> 21, 0, 0, id_2254
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6576-8'" then
                {
                    observation -> data.blockindex  = 21;
                    observation -> data.groupindex  = 0;
                    observation -> data.repeatindex = 0;
                    observation -> data.itemid      = 'id_2254';
                            code -> data.values as values, 
                                    values.value    = 'positiv';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA6577-6'" then
                {
                    observation -> data.blockindex  = 21;
                    observation -> data.groupindex  = 0;
                    observation -> data.repeatindex = 0;
                    observation -> data.itemid      = 'id_2254';
                            code -> data.values as values, 
                                    values.value    = 'negativ';
                };

                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code where "code = 'LA18198-4'" then
                {
                    observation -> data.blockindex  = 21;
                    observation -> data.groupindex  = 0;
                    observation -> data.repeatindex = 0;
                    observation -> data.itemid      = 'id_2254';
                            code -> data.values as values,
                                    values.value    = 'nicht auswertbar';
                };
            };
            //Erster Fusionspartner -> erster-fusionspartner component -> 21, 0, id_2255
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48018-6'" then
                {
                    component.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding, coding.code as code  then
                    {
                        observation -> data.blockindex  = 21;
                        observation -> data.groupindex  = 0;
                        observation -> data.repeatindex = 0;
                        observation -> data.itemid      = 'id_2255';
                            code   -> data.values as values,
                                        values.value    = code;
                    };
                };
            };
            //Zweiter Fusionspartner -> fusionspartner component -> 21, 0, id_2256
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueString as valueString where "code.coding.code = 'C28510'" then
                    {
                        observation  -> data.blockindex  = 21;
                        observation  -> data.groupindex  = 0;
                        observation  -> data.repeatindex = 0;
                        observation  -> data.itemid      = 'id_2256';
                        valueString  -> data.values as values,
                                        values.value     =  valueString;
                    };
                };
            };
            //Anzahl der Fusionsreads -> anzahl-der-fusionsreads component -> 21, 0, id_2257
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueInteger as valueInteger where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex  = 21;
                        observation  -> data.groupindex  = 0;
                        observation  -> data.repeatindex = 0;
                        observation  -> data.itemid      = 'id_2257';
                        valueInteger -> data.values as values, 
                                        values.unit      = 'count', 
                                        values.value     =  valueInteger;
                    };
                };
            };

            //Exon erster Fusionspartner -> exon-erster-fusionspartner component -> 21, 0, id_2258
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'erster-fusionspartner-exon'" then
                {
                    component.valueInteger as code then
                    {
                        observation -> data.blockindex  = 21;
                        observation -> data.groupindex  = 0;
                        observation -> data.repeatindex = 0;
                        observation -> data.itemid      = 'id_2258';
                            code   -> data.values as values,
                                        values.value    = code;
                    };
                };
            };

            //Exon zweiter Fusionspartner -> exon-zweiter-fusionspartner component -> 21, 0, id_2259
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = 'zweiter-fusionspartner-exon'" then
                {
                    component.valueInteger as code then
                    {
                        observation -> data.blockindex  = 21;
                        observation -> data.groupindex  = 0;
                        observation -> data.repeatindex = 0;
                        observation -> data.itemid      = 'id_2259';
                            code   -> data.values as values,
                                        values.value    = code;
                    };
                };
            };
        };
        /*------------------------------------------------------------------------------
                                    Fast Track                                  
        ------------------------------------------------------------------------------*/
        /* ------------ Observation BRAF Exon 15 Fast Track -------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.display = 'BRAF Exon 15 Mutation'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fasttrack'" then
        {
            //Date Of Assesment -> 22, 0, id_1945
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as effectiveDateTime then
                {
                    observation -> data.blockindex = 22;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_1945';
                    effectiveDateTime -> data.values as values, 
                                      values.value = effectiveDateTime;
                };
            };
            //Ergebnis -> 22, 0, id_1946
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code then
                {
                    observation -> data.blockindex = 22;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_1946';
                            code -> data.values as values, 
                                    values.value   = code;
                };
            };
            //Change DNA -> dna-chg component -> 22, 0, id_1947
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48004-6'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 22;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_1947';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Change Protein -> amino-acid-chg component -> 22, 0, id_1948
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48005-3'" then
                {
                    component.valueString as valueString then
                    {
                        observation -> data.blockindex  = 22;
                        observation -> data.groupindex  = 0;
                        observation -> data.itemid      = 'id_1948';
                        valueString -> data.values as values,
                                        values.value    = valueString;
                    };
                };
            };
        };
        /* ------------ Observation BRAF Exon 19 Fast Track -------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.display = 'EGFR Exon 19 Mutation'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fasttrack'" then
        {
            //Date of Assessment  -> 23, 0, ft_grp_egfr_19-21
            // Assay -> assay component -> 23, 0, id_2608
            // Hersteller -> hersteller -> 23, 0, id_2609
            //these three items shown before were mapped in the following group
            observation then TransformObservationFastTrackDateAssayHerstellerEGFREXO1921(observation, tgt);

            //Ergebnis -> 23, 0, id_1950
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code then
                {
                    observation -> data.blockindex = 23;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_1950';
                            code -> data.values as values, 
                                    values.value   = code;
                };
            };
            //Change DNA -> dna-chg component -> 23, 0, id_1951
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48004-6'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 23;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_1951';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Change Protein -> amino-acid-chg component -> 23, 0, id_1952
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48005-3'" then
                {
                    component.valueString as valueString then
                    {
                        observation -> data.blockindex  = 23;
                        observation -> data.groupindex  = 0;
                        observation -> data.itemid      = 'id_1952';
                        valueString -> data.values as values,
                                        values.value    = valueString;
                    };
                };
            };
        };
        /* ------------ Observation BRAF Exon 20 Fast Track -------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.display = 'EGFR Exon 20 Mutation'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fasttrack'" then
        {
            //Date of Assessment  -> 23, 0, ft_grp_egfr_19-21
            // Assay -> assay component -> 23, 0, id_2608
            // Hersteller -> hersteller -> 23, 0, id_2609
            //these three items shown before were mapped in the following group
            observation then TransformObservationFastTrackDateAssayHerstellerEGFREXO1921(observation, tgt);

            //Ergebnis -> 23, 0, id_1954
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code then
                {
                    observation -> data.blockindex = 23;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_1954';
                            code -> data.values as values, 
                                    values.value   = code;
                };
            };
            //Change DNA -> dna-chg component -> 23, 0, id_1955
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48004-6'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 23;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_1955';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Change Protein -> amino-acid-chg component -> 23, 0, id_1956
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48005-3'" then
                {
                    component.valueString as valueString then
                    {
                        observation -> data.blockindex  = 23;
                        observation -> data.groupindex  = 0;
                        observation -> data.itemid      = 'id_1956';
                        valueString -> data.values as values,
                                        values.value    = valueString;
                    };
                };
            };
        };
        /* ------------ Observation BRAF Exon 21 Fast Track -------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.display = 'EGFR Exon 21 Mutation'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fasttrack'" then
        {
            //Date of Assessment  -> 23, 0, ft_grp_egfr_19-21
            // Assay -> assay component -> 23, 0, id_2608
            // Hersteller -> hersteller -> 23, 0, id_2609
            //these three items shown before were mapped in the following group
            observation then TransformObservationFastTrackDateAssayHerstellerEGFREXO1921(observation, tgt);

            //Ergebnis -> 23, 0, id_1958
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code then
                {
                    observation -> data.blockindex = 23;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_1958';
                            code -> data.values as values, 
                                    values.value   = code;
                };
            };
            //Change DNA -> dna-chg component -> 23, 0, id_1959
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48004-6'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 23;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_1959';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Change Protein -> amino-acid-chg component -> 23, 0, id_1960
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48005-3'" then
                {
                    component.valueString as valueString then
                    {
                        observation -> data.blockindex  = 23;
                        observation -> data.groupindex  = 0;
                        observation -> data.itemid      = 'id_1960';
                        valueString -> data.values as values,
                                        values.value    = valueString;
                    };
                };
            };
        };
        /* -------------- Observation KRAS Exon Fast Track --------------------- */
        entry.resource as observation where "resource is Observation and resource.code.coding.display = 'KRAS Exon 2 Mutation'
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fasttrack'" then
        {
            //Date Of Assesment -> 24, 0, id_1961
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as effectiveDateTime then
                {
                    observation -> data.blockindex = 24;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_1961';
                    effectiveDateTime -> data.values as values, 
                                      values.value = effectiveDateTime;
                };
            };
            //Ergebnis -> 24, 0, id_1962
            observation -> tgt.data as data then
            {
                observation.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding,
                    coding.code as code then
                {
                    observation -> data.blockindex = 24;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid     = 'id_1962';
                            code -> data.values as values, 
                                    values.value   = code;
                };
            };
            //Change DNA -> dna-chg component -> 24, 0, id_1963
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48004-6'" then
                {
                    component.valueString as value  then
                    {
                        observation -> data.blockindex = 24;
                        observation -> data.groupindex = 0;
                        observation -> data.itemid     = 'id_1963';
                            value   -> data.values as values,
                                        values.value   = value;
                    };
                };
            };
            //Change Protein -> amino-acid-chg component -> 24, 0, id_1964
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48005-3'" then
                {
                    component.valueString as valueString then
                    {
                        observation -> data.blockindex  = 24;
                        observation -> data.groupindex  = 0;
                        observation -> data.itemid      = 'id_1964';
                        valueString -> data.values as values,
                                        values.value    = valueString;
                    };
                };
            };
        };
        /*------------------------------------------------------------------------------
                                    Fusion NGS                                  
        ------------------------------------------------------------------------------*/
        /* --------------------- Device NGSPanel Fusion NGS -------------------- */
        entry.resource as device where "resource is Device" then
        {
            //NGS Panel -> 2, 0, id_2513
            device -> tgt.data as data then
            {
                device -> data.blockindex = 2;
                device -> data.groupindex = 0;
                device -> data.itemid     = 'id_2513';
                device  -> data.values as values, 
                                values.value = 'yes';
            };
            //NGS Lung Panel Version -> 25, 0, id_1260
            device -> tgt.data as data then
            {
                device.version as version, 
                version.value as value then
                {
                    device -> data.blockindex = 25;
                    device -> data.groupindex = 0;
                    device -> data.itemid     = 'id_1260';
                    value  -> data.values as values, 
                                 values.value = value;
                };
            };
        };
        /* ----------------- Observation NGSPanel Fusion NGS ------------------- */
        entry.resource as observation where "resource is Observation 
                                            and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-panel'" then
        {
            //Date Of Assesment -> 26, 0, 0, id_1160
            observation-> tgt.data as data then
            {
                observation.effectiveDateTime as effectiveDateTime then
                {
                    observation -> data.blockindex  = 26;
                    observation -> data.groupindex  = 0;
                    observation -> data.repeatindex = 0;
                    observation -> data.itemid      = 'id_1160';
                    effectiveDateTime -> data.values as values, 
                                       values.value = effectiveDateTime;
                };
            };
            //Gen -> gene-studied -> 26, 0, id_1159
            observation -> tgt.data as data then
            {
                observation.component as component, 
                component.code where "code.coding.code = '48018-6'" then
                {
                    component.valueCodeableConcept as valueCodeableConcept,
                    valueCodeableConcept.coding as coding, coding.code as code  then
                    {
                        observation -> data.blockindex  = 26;
                        observation -> data.groupindex  = 0;
                        observation -> data.repeatindex = 0;
                        observation -> data.itemid      = 'id_1159';
                            code   -> data.values as values,
                                        values.value    = code;
                    };
                };
            };
            //Exon -> exon -> 26, 0, 0, id_35
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueString as valueString where "code.coding.code = 'C13231'" then
                    {
                        observation  -> data.blockindex  = 26;
                        observation  -> data.groupindex  = 0;
                        observation  -> data.repeatindex = 0;
                        observation  -> data.itemid      = 'id_35';
                        valueString  -> data.values as values,
                                        values.value     =  valueString;
                    };
                };
            };

            //HGVS c. (Mutation cDNA) -> dna-chg -> 26, 0, 0, id_36
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueString as valueString where "code.coding.code = '48004-6'" then
                    {
                        observation  -> data.blockindex  = 26;
                        observation  -> data.groupindex  = 0;
                        observation  -> data.repeatindex = 0;
                        observation  -> data.itemid      = 'id_36';
                        valueString  -> data.values as values,
                                        values.value     =  valueString;
                    };
                };
            };
            //HGVS p. (Mutation Protein) -> 26, 0, 0, id_37
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueString as valueString where "code.coding.code = '48005-3'" then
                    {
                        observation  -> data.blockindex  = 26;
                        observation  -> data.groupindex  = 0;
                        observation  -> data.repeatindex = 0;
                        observation  -> data.itemid      = 'id_37';
                        valueString  -> data.values as values,
                                        values.value     =  valueString;
                    };
                };
            };
            //Allelic fraction -> allelicfraction  -> 26, 0, 0, id_38
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueQuantity as quantity where "code.coding.code = 'C154665'" then
                    {
                        observation -> data.blockindex  = 26;
                        observation -> data.groupindex  = 0;
                        observation -> data.repeatindex = 0;
                        observation -> data.itemid      = 'id_38';
                        quantity.value as value ->data.values as values, 
                                            values.unit = 'percent', 
                                           values.value = value;
                    };
                };
            };
            //Referenztranskript -> referenztranskript -> 26, 0, 0, ngs_panel_reftranscript
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueString as valueString where "code.coding.code = '51958-7'" then
                    {
                        observation  -> data.blockindex  = 26;
                        observation  -> data.groupindex  = 0;
                        observation  -> data.repeatindex = 0;
                        observation  -> data.itemid      = 'ngs_panel_reftranscript';
                        valueString  -> data.values as values,
                                        values.value     =  valueString;
                    };
                };
            };
            //Coverage -> coverage -> 26, 0, 0, ngs_panel_coverage
            observation -> tgt.data as data then
            {
                observation.component as component then
                {
                    component.valueString as valueString where "code.coding.code = '82121-5'" then
                    {
                        observation  -> data.blockindex  = 26;
                        observation  -> data.groupindex  = 0;
                        observation  -> data.repeatindex = 0;
                        observation  -> data.itemid      = 'ngs_panel_coverage';
                        valueString  -> data.values as values,
                                        values.value     =  valueString;
                    };
                };
            };
            //Biologische/molekulare Bewertung  -> 26, 0, 0, id_47
            observation -> tgt.data as data then
            {
                observation.interpretation as interpretation,
                    interpretation.coding as coding,
                    coding.code as code then
                    {
                        observation -> data.blockindex  = 26;
                        observation -> data.groupindex  = 0;
                        observation -> data.repeatindex = 0;
                        observation -> data.itemid      = 'id_47';
                            code -> data.values as values, 
                                        values.value    = code;
                    };
            };
            //Kommentar -> 26, 0, 0, id_48
            observation -> tgt.data as data then
            {
                observation.note as note, 
                note.text as text then
                {
                    observation -> data.blockindex  = 26;
                    observation -> data.groupindex  = 0;
                    observation -> data.repeatindex = 0;
                    observation -> data.itemid      = 'id_48';
                            text -> data.values as values, 
                                    values.value    = text;
                };
            };
        };
    };
}
/*------------------------------------------------------------------------------
                             HELPERS                                   
------------------------------------------------------------------------------*/
group TransformationObservationALKDatePhanotypVorbefund(source src:Observation, target tgt: BackboneElement)
{
    //Date Of Assesment -> 3, 0, id_2098
    src-> tgt.data as data then
    {
        src.effectiveDateTime as edt where "code.coding.code = 'ALK' and %tgt.data.where(itemid = 'id_2098').exists().not()" then
        {
            src -> data.blockindex   = 3;
            src -> data.groupindex   = 0;
            src -> data.itemid       = 'id_2098';
            edt-> data.values as values, 
                        values.value = edt;
        };
    };
    
    //Phänotyp: phanotyp component-> 3, 0, id_2099
    src -> tgt.data as data then
    {
        src.component as component, 
        component.code where "code.coding.code = 'C16977'" then
        {
            component.valueString as value where "%tgt.data.where(itemid = 'id_2099').exists().not()" then
            {
                src -> data.blockindex = 3;
                src -> data.groupindex = 0;
                src -> data.itemid     = 'id_2099';
                    value -> data.values as values,
                        values.value   = value;
                    value -> data.values as values, 
                        values.unit    = 'predef', 
                        values.value   = 'Fusion';
            };
        };
    };
}
group TransformationObservationMETDatePhanotypVorbefund(source src:Observation, target tgt: BackboneElement)
{
    //Date Of Assesment -> 6, 0, id_2132
    src-> tgt.data as data then
    {
        src.effectiveDateTime as edt where "code.coding.code = 'MET' and %tgt.data.where(itemid = 'id_2132').exists().not()" then
        {
            src -> data.blockindex = 6;
            src -> data.groupindex = 0;
            src -> data.itemid     = 'id_2132';
            edt-> data.values as values, 
                      values.value = edt;
        };
    };
    //Phänotyp: phanotyp component-> 6, 0, id_2133
    src -> tgt.data as data then
    {
        src.component as component, 
        component.code where "code.coding.code = 'C16977'" then
        {
            component.valueString as value where "%tgt.data.where(itemid = 'id_2133').exists().not()" then
            {
                src   -> data.blockindex = 6;
                src   -> data.groupindex = 0;
                src   -> data.itemid     = 'id_2133';
                value -> data.values as values,
                          values.value   = value;
                value -> data.values as values, 
                          values.unit    = 'predef', 
                          values.value   = 'Amplifikation';
            };
        };
    };
}
group TransformationObservationROS1DatePhanotypVorbefund(source src:Observation, target tgt: BackboneElement)
{
    //Date Of Assesment -> 17, 0, id_2211
    src-> tgt.data as data then
    {
        src.effectiveDateTime as period, 
        period as dateOfAssessment where "%tgt.data.where(itemid = 'id_2211').exists().not()" then
        {
            src -> data.blockindex = 17;
            src -> data.groupindex = 0;
            src -> data.itemid     = 'id_2211';
            dateOfAssessment-> data.values as values, 
                      values.value = dateOfAssessment;
        };
    };
    //Phänotyp: phanotyp component-> 17, 0, id_2212
    src -> tgt.data as data then
    {
        src.component as component, 
        component.code where "code.coding.code = 'C16977'" then
        {
            component.valueString as value where "%tgt.data.where(itemid = 'id_2212').exists().not()" then
            {
                src   -> data.blockindex   = 17;
                src   -> data.groupindex   = 0;
                src   -> data.itemid       = 'id_2212';
                value -> data.values as values,
                            values.value   = value;
                value -> data.values as values, 
                            values.unit    = 'predef', 
                            values.value   = 'Fusion';
            };
        };
    };
}
group TransformationObservationRETDatePhanotypVorbefund(source src:Observation, target tgt: BackboneElement)
{
     //Date Of Assesment -> 20, 0, id_2183
    src-> tgt.data as data then
    {
        src.effectiveDateTime as edt where "code.coding.code = 'RET' and %tgt.data.where(itemid = 'id_2183').exists().not()" then
        {
            src -> data.blockindex = 20;
            src -> data.groupindex = 0;
            src -> data.itemid     = 'id_2183';
            edt-> data.values as values, values.value = edt;
        };
    };

    //Phänotyp: phanotyp component-> 20, 0, id_2184
    src -> tgt.data as data then
    {
        src.component as component, 
        component.code where "code.coding.code = 'C16977'" then
        {
            component.valueString as value where "%tgt.data.where(itemid = 'id_2184').exists().not()" then
            {
                src   -> data.blockindex   = 20;
                src   -> data.groupindex   = 0;
                src   -> data.itemid       = 'id_2184';
                value -> data.values as values,
                            values.value   = value;
                value -> data.values as values, 
                            values.unit    = 'predef', 
                            values.value   = 'Fusion';
            };
        };
    };
}
group TransformObservationFastTrackDateAssayHerstellerEGFREXO1921(source src:Observation, target tgt: BackboneElement)
{
    //Date Of Assesment -> 23, 0, ft_grp_egfr_19-21
    src-> tgt.data as data then
    {
        src.effectiveDateTime as effectiveDateTime where "%tgt.data.where(itemid = 'ft_grp_egfr_19-21').exists().not()" then
        {
            src -> data.blockindex   = 23;
            src -> data.groupindex   = 0;
            src -> data.itemid       = 'ft_grp_egfr_19-21';
            effectiveDateTime -> data.values as values, 
                        values.value = effectiveDateTime;
        };
    };
    //Assay -> assay component -> 23, 0, id_2608
    src -> tgt.data as data then
    {
        src.component as component, 
        component.code where "code.coding.code = 'C60819'" then
        {
            component.valueCodeableConcept as valueCodeableConcept,
            valueCodeableConcept.coding as coding, 
            coding.code as code where "%tgt.data.where(itemid = 'id_2608').exists().not()" then
            {
                src -> data.blockindex = 23;
                src -> data.groupindex = 0;
                src -> data.itemid     = 'id_2608';
                    code -> data.values as values,
                        values.value   = code;
            };
        };
    };
    // Hersteller -> hersteller component -> 23, 0, id_2609
    src -> tgt.data as data then
    {
        src.component as component, 
        component.code where "code.coding.code = 'C25392'" then
        {
            component.valueCodeableConcept as valueCodeableConcept,
            valueCodeableConcept.coding as coding, 
            coding.code as code where "%tgt.data.where(itemid = 'id_2609').exists().not()" then
            {
                src -> data.blockindex = 23;
                src -> data.groupindex = 0;
                src -> data.itemid     = 'id_2609';
                    code -> data.values as values,
                        values.value   = code;
            };
        };
    };
}
/* ------- Create Checkboxes for field Immunhistochemie (IHC) -------- */
group TransformImmunhistochemieIHCCheckboxes(source src: Bundle, target tgt: BackboneElement)
{
    src.entry as entry then
    {
        src-> tgt.data as data then
        {
            entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ihc'" then
            {
                observation.status as status where "%tgt.data.where(itemid = 'id_2508').exists().not()" then
                {
                    observation -> data.blockindex = 2;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2508';

                    observation where "%src.entry.resource.code.coding.where(code = 'BRAF').exists()" then
                    {
                        observation -> data.values as values, values.value = 'BRAF';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'CK7').exists()" then
                    {
                        observation -> data.values as values, values.value = 'CK7';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'MIB1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'MIB1';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'Napsin A').exists()" then
                    {
                        observation -> data.values as values, values.value = 'Napsin A';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'P40').exists()" then
                    {
                        observation -> data.values as values, values.value = 'P40';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'Synaptophysin').exists()" then
                    {
                        observation -> data.values as values, values.value = 'Synaptophysin';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'TTF1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'TTF1';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'ALK').exists()" then
                    {
                        observation -> data.values as values, values.value = 'ALK';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'MET').exists()" then
                    {
                        observation -> data.values as values, values.value = 'MET';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'PD-L1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'PD-L1';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'ROS1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'ROS1';
                    };
                };
            };
        };
    };
}
/*-- Create Checkboxes for Chromogenic in-situ-Hybridisierung(CISH)---*/
group TransformChromogenicinsituHybridisierungCISHCheckboxes(source src: Bundle, target tgt: BackboneElement)
{
    src.entry as entry then
    {
        src-> tgt.data as data then
        {
            entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ish'" then
            {
                observation.status as status where "%tgt.data.where(itemid = 'id_2509').exists().not()" then
                {
                    observation -> data.blockindex = 2;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2509';
                    
                    observation where "%src.entry.resource.code.coding.where(code = 'ALK').exists()" then
                    {
                        observation -> data.values as values, values.value = 'ALK';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'MET').exists()" then
                    {
                        observation -> data.values as values, values.value = 'MET';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'RET').exists()" then
                    {
                        observation -> data.values as values, values.value = 'RET';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'ROS1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'ROS1';
                    };
                };
            };
        };
    };
}
/*-- Create Checkboxes for Fluoreszenz-in-situ-Hybridisierung (FISH)-- */
group TransformFluoreszenzinsituHybridisierungFISHCheckboxes(source src: Bundle, target tgt: BackboneElement)
{
    src.entry as entry then
    {
        src-> tgt.data as data then
        {
            entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fish'" then
            {
                observation.status as status where "%tgt.data.where(itemid = 'id_2510').exists().not()" then
                {
                    observation -> data.blockindex = 2;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2510';

                    observation where "%src.entry.resource.code.coding.where(code = 'ALK').exists()" then
                    {
                        observation -> data.values as values, values.value = 'ALK';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'MET').exists()" then
                    {
                        observation -> data.values as values, values.value = 'MET';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'RET').exists()" then
                    {
                        observation -> data.values as values, values.value = 'RET';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'ROS1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'ROS1';
                    };
                };
            };
        };       
    };
}
/*----------------- Create Checkboxes for Fusion NGS ----------------- */
group TransformFusionNGSCheckboxes(source src: Bundle, target tgt: BackboneElement)
{
    src.entry as entry then
    {
        src-> tgt.data as data then
        {
            entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/ngs-fusion-expression'" then
            {
                observation.status as status where "%tgt.data.where(itemid = 'id_2511').exists().not()" then
                {
                    observation -> data.blockindex = 2;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2511';

                    observation where "%src.entry.resource.code.coding.where(code = 'ALK').exists()" then
                    {
                        observation -> data.values as values, values.value = 'ALK';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'RET').exists()" then
                    {
                        observation -> data.values as values, values.value = 'RET';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'ROS1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'ROS1';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'NTRK1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'NTRK1';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'NTRK2').exists()" then
                    {
                        observation -> data.values as values, values.value = 'NTRK2';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'NTRK3').exists()" then
                    {
                        observation -> data.values as values, values.value = 'NTRK3';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'FGFR1').exists()" then
                    {
                        observation -> data.values as values, values.value = 'FGFR1';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'FGFR2').exists()" then
                    {
                        observation -> data.values as values, values.value = 'FGFR2';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'FGFR3').exists()" then
                    {
                        observation -> data.values as values, values.value = 'FGFR3';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'Sonstiges').exists()" then
                    {
                        observation -> data.values as values, values.value = 'Sonstiges';
                    };
                };
            };
        };
    };
}
/*----------------- Create Checkboxes for Fast Track ----------------- */
group TransformFastTrackCheckboxes(source src: Bundle, target tgt: BackboneElement)
{
    src.entry as entry then
    {
        src -> tgt.data as data then
        {
            entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/fasttrack'" then
            {
                observation.status as status where "%tgt.data.where(itemid = 'id_2512').exists().not()" then
                {
                    observation -> data.blockindex = 2;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2512';
                    observation where "%src.entry.resource.code.coding.where(code = 'C158854').exists()" then
                    {
                        observation -> data.values as values, values.value = 'BRAF Exon 15';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'C128662').exists()" then
                    {
                        observation -> data.values as values, values.value = 'EGFR Exon 19-21';
                    };
                    observation where "%src.entry.resource.code.coding.where(code = 'C135715').exists()" then
                    {
                        observation -> data.values as values, values.value = 'KRAS Exon 2';
                    };
                };
            };
        };
    };
}
